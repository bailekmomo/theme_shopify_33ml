
{% assign block_settings = block.settings %}

{%- liquid
  assign show_intensity = false
  assign show_notes = false
  
  if closest.product and closest.product.metafields.custom.intensite
    assign show_intensity = true
  endif
  
  if closest.product and closest.product.metafields.custom.notes_olfactives
    assign show_notes = true
    assign notes = closest.product.metafields.custom.notes_olfactives.value
  endif
-%}

<div class="product-info-callouts" {{ block.shopify_attributes }}>
  <div class="product__callouts-items" data-with-box="{{ block_settings.add_box }}" data-with-dividers="{{ block_settings.add_dividers }}">
    
    {%- if show_intensity -%}
      <div class="product__callouts-item fs-body-75">
        <span class="icon icon-new product__callouts-item-icon">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 2v20M12 2l-3 3m3-3l3 3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M6 8h12M6 12h12M6 16h12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
        </span>
        <div class="product__callouts-item-text rte">
          <p><strong>Intensité:</strong> {{ closest.product.metafields.custom.intensite.value }}/10</p>
        </div>
      </div>
    {%- endif -%}

    {%- if show_notes -%}
      {% for note in notes %}
        {% assign note_trimmed = note | strip %}
        <div class="product__callouts-item fs-body-75">
          <span class="icon icon-new product__callouts-item-icon">
            {% case note_trimmed %}
              {% when 'Rose' %}
                {% render 'icon-note-rose' %}
              {% when 'Musc' %}
                {% render 'icon-note-musc' %}
              {% when 'Ambre' %}
                {% render 'icon-note-ambre' %}
              {% when 'Vanille' %}
                {% render 'icon-note-vanille' %}
              {% when 'Bois' %}
                {% render 'icon-note-bois' %}
              {% when 'Agrumes' %}
                {% render 'icon-note-agrumes' %}
              {% when 'Floral' %}
                {% render 'icon-note-floral' %}
              {% when 'Épicé' %}
                {% render 'icon-note-epice' %}
              {% when 'Océan' %}
                {% render 'icon-note-ocean' %}
              {% else %}
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="1.5"/>
                  <path d="M12 8v8M8 12h8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
            {% endcase %}
          </span>
          <div class="product__callouts-item-text rte">
            <p>{{ note_trimmed }}</p>
          </div>
        </div>
      {% endfor %}
    {%- endif -%}
    
  </div>
</div>

{% stylesheet %}
  .product-info-callouts {
    margin: var(--margin-lg) 0;
  }

  /* Limiter la taille des icônes pour qu'elles restent petites */
  .product-info-callouts .product__callouts-item-icon {
    width: 24px;
    height: 24px;
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .product-info-callouts .product__callouts-item-icon svg {
    width: 100%;
    height: 100%;
    max-width: 24px;
    max-height: 24px;
  }

  .icon-elegant {
    fill: currentColor;
    stroke: currentColor;
  }
  
  /* S'assurer que le texte est aligné à côté de l'icône */
  .product-info-callouts .product__callouts-item {
    display: flex;
    align-items: center;
    gap: 12px;
  }
  
  .product-info-callouts .product__callouts-item-text {
    flex: 1;
  }
  
  .product-info-callouts .product__callouts-item-text p {
    margin: 0;
  }
{% endstylesheet %}

{% schema %}
{
  "name": "Intensité & Notes",
  "tag": null,
  "settings": [
    {
      "type": "header",
      "content": "Affichage"
    },
    {
      "type": "paragraph",
      "content": "Ce bloc affiche automatiquement l'intensité et les notes olfactives du produit."
    },
    {
      "type": "checkbox",
      "id": "add_box",
      "label": "Ajouter une bordure",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "add_dividers",
      "label": "Ajouter des séparateurs",
      "default": true
    }
  ],
  "presets": [
    {
      "name": "Intensité & Notes",
      "category": "Produit"
    }
  ]
}
{% endschema %}

