
{%- liquid
  assign product_resource = closest.product | default: product
-%}
{%- if product_resource.metafields.custom.intensite -%}
  {%- liquid
    # Convertir l'intensité de 1-10 vers 1-5
    assign intensity_value = product_resource.metafields.custom.intensite.value | times: 1.0
    assign intensity_on_5 = intensity_value | divided_by: 2.0 | round
    # S'assurer que la valeur est entre 1 et 5
    if intensity_on_5 < 1
      assign intensity_on_5 = 1
    elsif intensity_on_5 > 5
      assign intensity_on_5 = 5
    endif
  -%}
  <div 
    class="intensity-linear-container spacing-style"
    style="{% render 'spacing-style', settings: block.settings %}"
    {{ block.shopify_attributes }}
  >
    <div class="intensity-header">
      <span class="intensity-title">INTENSITÉ</span>
      <span class="intensity-value">{{ intensity_on_5 }}/5</span>
    </div>
    
    <div class="intensity-segments">
      {% for i in (1..5) %}
        <span class="segment {% if i <= intensity_on_5 %}segment-filled{% endif %}"></span>
      {% endfor %}
    </div>
  </div>
{%- endif -%}

{% stylesheet %}
  .intensity-linear-container {
    margin: 25px 0;
  }
  
  /* Version compacte dans les cartes produit */
  .product-card .intensity-linear-container {
    margin: 12px 0;
  }
  
  .intensity-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
    font-size: 13px;
    font-weight: 600;
    letter-spacing: 1px;
  }
  
  .product-card .intensity-header {
    margin-bottom: 8px;
    font-size: 11px;
    letter-spacing: 0.5px;
  }
  
  .intensity-title {
    color: #333;
  }
  
  .intensity-value {
    color: #666;
    font-weight: 500;
  }
  
  /* Conteneur des 5 segments */
  .intensity-segments {
    display: flex;
    gap: 8px;
    align-items: flex-end;
    height: 40px;
  }
  
  .product-card .intensity-segments {
    height: 30px;
    gap: 6px;
  }
  
  /* Chaque segment individuel */
  .segment {
    flex: 1;
    background-color: #e8e8e8;
    border-radius: 3px;
    transition: background-color 0.3s ease, transform 0.3s ease;
    opacity: 0;
    transform: scaleY(0);
    transform-origin: bottom;
    animation: growSegment 0.5s ease-out forwards;
  }
  
  /* Hauteurs croissantes pour effet de jauge graduée */
  .segment:nth-child(1) {
    height: 20%;
    animation-delay: 0.1s;
  }
  
  .segment:nth-child(2) {
    height: 40%;
    animation-delay: 0.2s;
  }
  
  .segment:nth-child(3) {
    height: 60%;
    animation-delay: 0.3s;
  }
  
  .segment:nth-child(4) {
    height: 80%;
    animation-delay: 0.4s;
  }
  
  .segment:nth-child(5) {
    height: 100%;
    animation-delay: 0.5s;
  }
  
  /* Animation d'apparition des segments */
  @keyframes growSegment {
    from {
      opacity: 0;
      transform: scaleY(0);
    }
    to {
      opacity: 1;
      transform: scaleY(1);
    }
  }
  
  /* Segment rempli (actif) */
  .segment-filled {
    background-color: #333;
  }
  
  /* Effet hover sur le conteneur */
  .intensity-linear-container:hover .segment {
    transform: scaleY(1.05);
  }
  
  .intensity-linear-container:hover .segment-filled {
    background-color: #000;
  }
  
  /* Responsive mobile */
  @media (max-width: 768px) {
    .intensity-header {
      font-size: 12px;
    }
    
    .intensity-segments {
      height: 30px;
      gap: 5px;
    }
    
    .segment {
      border-radius: 2px;
    }
  }
{% endstylesheet %}

{% schema %}
{
  "name": "Intensité",
  "settings": [
    {
      "type": "header",
      "content": "Espacement"
    },
    {
      "type": "range",
      "id": "padding-block-start",
      "label": "Haut",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding-block-end",
      "label": "Bas",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding-inline-start",
      "label": "Gauche",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding-inline-end",
      "label": "Droite",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 0
    }
  ],
  "presets": [
    {
      "name": "Intensité",
      "category": "Produit"
    }
  ]
}
{% endschema %}

